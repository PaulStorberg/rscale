<div class="poll-edit">
  <%= render partial: "polls/form" %>
  <% if policy(@poll).update? %>
    <% if current_user.email_groups.any? %>
      <%= link_to 'Add Groups', add_groups_path(poll_id: @poll.id), remote: true %><br />
    <% else %>
      <%= link_to 'Create Group', new_group_path %><br />
    <% end %>
    <%= link_to 'Add Users', new_poll_roles_path(poll_id: @poll.id), remote: true %><br />
  <% end %>
  <%= link_to 'View Poll', poll_path(@poll) %>

  <% if policy(@poll).update? %>
    <div class="poll-option-user-index">
      <% if @poll.roles.any? %>
        <h5><%= @poll.title %> Participants</h5>
        <table>
          <thead>
            <tr>
              <th>Email</th>
              <th>Remove</th>
            </tr>
          </thead>
          <tbody>
            <% @poll.roles.each do |role| %>
              <% role.users.each do |user| %>
                <tr>
                  <td><%= user.email %></td>
                  <td><%= link_to 'Remove user', remove_user_from_poll_path(resource_id: role.resource_id, name: role.name, user_id: user.id) %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      <% end %>
    </div>
  <% end %>
</div>
